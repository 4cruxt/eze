!function(t,e){"function"==typeof define&&define.amd?define(e):"object"==typeof exports?module.exports=e():t.Blazy=e()}(this,function(){"use strict";var t,e,o,n="src",s="srcset";return function(n){if(!document.querySelectorAll){var s=document.createStyleSheet();document.querySelectorAll=function(t,e,o,n,i){for(i=document.all,e=[],o=(t=t.replace(/\[for\b/gi,"[htmlFor").split(",")).length;o--;){for(s.addRule(t[o],"k:v"),n=i.length;n--;)i[n].currentStyle.k&&e.push(i[n]);s.removeRule(0)}return e}}var a=this,l=a._util={};l.elements=[],l.destroyed=!0,a.options=n||{},a.options.error=a.options.error||!1,a.options.offset=a.options.offset||100,a.options.success=a.options.success||!1,a.options.selector=a.options.selector||".b-lazy",a.options.separator=a.options.separator||"|",a.options.container=!!a.options.container&&document.querySelectorAll(a.options.container),a.options.errorClass=a.options.errorClass||"b-error",a.options.breakpoints=a.options.breakpoints||!1,a.options.loadInvisible=a.options.loadInvisible||!1,a.options.successClass=a.options.successClass||"b-loaded",a.options.validateDelay=a.options.validateDelay||25,a.options.saveViewportOffsetDelay=a.options.saveViewportOffsetDelay||50,a.options.srcset=a.options.srcset||"data-srcset",a.options.src=t=a.options.src||"data-src",o=window.devicePixelRatio>1,(e={}).top=0-a.options.offset,e.left=0-a.options.offset,a.revalidate=function(){i(this)},a.load=function(t,e){var o=this.options;void 0===t.length?c(t,e,o):h(t,function(t){c(t,e,o)})},a.destroy=function(){var t=this._util;this.options.container&&h(this.options.container,function(e){m(e,"scroll",t.validateT)}),m(window,"scroll",t.validateT),m(window,"resize",t.validateT),m(window,"resize",t.saveViewportOffsetT),t.count=0,t.elements.length=0,t.destroyed=!0},l.validateT=w(function(){r(a)},a.options.validateDelay,a),l.saveViewportOffsetT=w(function(){p(a.options.offset)},a.options.saveViewportOffsetDelay,a),p(a.options.offset),h(a.options.breakpoints,function(e){if(e.width>=window.screen.width)return t=e.src,!1}),setTimeout(function(){i(a)})};function i(t){var e=t._util;e.elements=function(t){for(var e=[],o=document.querySelectorAll(t),n=o.length;n--;e.unshift(o[n]));return e}(t.options.selector),e.count=e.elements.length,e.destroyed&&(e.destroyed=!1,t.options.container&&h(t.options.container,function(t){v(t,"scroll",e.validateT)}),v(window,"resize",e.saveViewportOffsetT),v(window,"resize",e.validateT),v(window,"scroll",e.validateT)),r(t)}function r(t){for(var o,n=t._util,s=0;s<n.count;s++){var i=n.elements[s];o=void 0,((o=i.getBoundingClientRect()).right>=e.left&&o.bottom>=e.top&&o.left<=e.right&&o.top<=e.bottom||f(i,t.options.successClass))&&(t.load(i),n.elements.splice(s,1),n.count--,s--)}0===n.count&&t.destroy()}function c(e,i,r){if(!f(e,r.successClass)&&(i||r.loadInvisible||e.offsetWidth>0&&e.offsetHeight>0)){var c=e.getAttribute(t)||e.getAttribute(r.src);if(c){var p=c.split(r.separator),w=p[o&&p.length>1?1:0],g=u(e,"img");if(g||void 0===e.src){var y=new Image;y.onerror=function(){r.error&&r.error(e,"invalid"),d(e,r.errorClass)};var b=function(){if(g){l(e,n,r.src),l(e,s,r.srcset);var t=e.parentNode;t&&u(t,"picture")&&h(t.getElementsByTagName("source"),function(t){l(t,s,r.srcset)})}else e.style.backgroundImage='url("'+w+'")';a(e,r),m(y,"load",b)};v(y,"load",b),y.src=w}else l(e,n,r.src),a(e,r)}else u(e,"video")?(h(e.getElementsByTagName("source"),function(t){l(t,n,r.src)}),e.load(),a(e,r)):(r.error&&r.error(e,"missing"),d(e,r.errorClass))}}function a(t,e){d(t,e.successClass),e.success&&e.success(t),h(e.breakpoints,function(e){t.removeAttribute(e.src)})}function l(t,e,o){var n=t.getAttribute(o);n&&(t[e]=n,t.removeAttribute(o))}function u(t,e){return t.nodeName.toLowerCase()===e}function f(t,e){return-1!==(" "+t.className+" ").indexOf(" "+e+" ")}function d(t,e){f(t,e)||(t.className+=" "+e)}function p(t){e.bottom=(window.innerHeight||document.documentElement.clientHeight)+t,e.right=(window.innerWidth||document.documentElement.clientWidth)+t}function v(t,e,o){t.attachEvent?t.attachEvent&&t.attachEvent("on"+e,o):t.addEventListener(e,o,!1)}function m(t,e,o){t.detachEvent?t.detachEvent&&t.detachEvent("on"+e,o):t.removeEventListener(e,o,!1)}function h(t,e){if(t&&e)for(var o=t.length,n=0;n<o&&!1!==e(t[n],n);n++);}function w(t,e,o){var n=0;return function(){var s=+new Date;s-n<e||(n=s,t.apply(o,arguments))}}});